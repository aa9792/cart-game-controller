<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€äº’å‹•æ•™æ¡ˆã€‘åŸºéš†é»‘é‡‘æ­²æœˆï¼šç©¿è¶Šç¤¦å‘çš„æ•¸æ“šæ¢éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- Animation Library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #111827; /* Dark theme base */
            color: #f3f4f6;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #d97706; border-radius: 4px; }

        /* Utilities */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .glass-panel {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Interactive Elements */
        .btn-primary {
            background-color: #d97706; /* Amber-600 */
            color: white;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background-color: #fbbf24; /* Amber-400 */
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .locked {
            filter: grayscale(100%);
            opacity: 0.5;
            pointer-events: none;
            cursor: not-allowed;
        }

        /* Flip Card Effect */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 200px;
            perspective: 1000px;
            cursor: pointer;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .flip-card-front {
            background-color: #1f2937;
            border: 2px solid #d97706;
        }
        .flip-card-back {
            background-color: #d97706;
            color: #111827;
            transform: rotateY(180deg);
        }

        /* --- Optimized Animations --- */
        @keyframes dig-action {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(-60deg); } /* Raise tool */
            50% { transform: rotate(10deg); }  /* Hit */
            60% { transform: rotate(0deg); }   /* Recoil */
            100% { transform: rotate(0deg); }
        }
        @keyframes drive-action {
            0% { transform: translateX(-2px) translateY(0); }
            25% { transform: translateX(2px) translateY(-1px); }
            50% { transform: translateX(-2px) translateY(0); }
            75% { transform: translateX(2px) translateY(-1px); }
            100% { transform: translateX(-2px) translateY(0); }
        }
        @keyframes wash-action {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes float-action {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-6px) rotate(3deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .animate-dig { animation: dig-action 1.2s infinite ease-in; transform-origin: bottom left; }
        .animate-drive { animation: drive-action 0.5s infinite linear; }
        .animate-wash { animation: wash-action 0.5s infinite linear; }
        .animate-float { animation: float-action 3s infinite ease-in-out; }

        /* Flow Arrow Animation */
        @keyframes flow-pulse {
            0% { opacity: 0.3; transform: translateX(0); }
            50% { opacity: 1; transform: translateX(5px); }
            100% { opacity: 0.3; transform: translateX(0); }
        }
        .flow-active { animation: flow-pulse 1s infinite; color: #fbbf24; }

        /* --- Scene Box Styles --- */
        .scene-box {
            position: relative;
            height: 120px;
            width: 100%;
            background: #0f172a;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-top: 1rem;
            border: 2px solid #374151;
            transition: background 0.5s ease;
        }
        .scene-element {
            position: absolute;
            font-size: 2.5rem;
            user-select: none;
        }
        .bg-cave { background: radial-gradient(circle at 50% 50%, #374151 0%, #111827 80%); }
        @keyframes scene-pickaxe-hit { 
            0% { transform: translateY(-50%) rotate(0deg); } 
            40% { transform: translateY(-50%) rotate(-70deg); } 
            50% { transform: translateY(-50%) rotate(10deg); } 
            100% { transform: translateY(-50%) rotate(0deg); } 
        }
        @keyframes dust-puff {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(2); }
        }
        .scene-mining-tool { left: 35%; top: 50%; transform: translateY(-50%); animation: scene-pickaxe-hit 1s infinite; transform-origin: bottom right; z-index: 10; }
        .scene-mining-coal { left: 55%; top: 50%; transform: translateY(-50%); font-size: 3rem; }
        .scene-mining-dust { left: 52%; top: 45%; font-size: 1.5rem; color: #a3a3a3; animation: dust-puff 1s infinite; animation-delay: 0.5s; }
        .bg-rails { background: linear-gradient(to bottom, #1f2937 80%, #4b5563 80%, #4b5563 85%, #1f2937 85%); }
        @keyframes cart-slide { 
            0% { left: -20%; transform: translateY(0) rotate(0deg); } 
            25% { transform: translateY(-2px) rotate(1deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(-2px) rotate(-1deg); }
            100% { left: 120%; transform: translateY(0) rotate(0deg); } 
        }
        .scene-transport-cart { top: 45%; animation: cart-slide 3.5s infinite linear; }
        .scene-track-decor { position: absolute; bottom: 15px; width: 100%; border-top: 2px dashed #9ca3af; height: 1px; }
        .bg-wash { background: #0c4a6e; }
        @keyframes water-splash {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 0.5; }
            100% { transform: translateY(0) scale(1); opacity: 0.8; }
        }
        .scene-wash-water-bg { position: absolute; width: 100%; height: 100%; opacity: 0.3; background-image: radial-gradient(#38bdf8 1px, transparent 1px); background-size: 10px 10px; }
        .scene-wash-coal-pile { left: 45%; top: 60%; transform: translate(-50%, -50%); animation: wash-action 0.2s infinite; }
        .scene-wash-spray { position: absolute; top: 10%; left: 50%; font-size: 1.5rem; animation: water-splash 0.5s infinite reverse; }
        .bg-sea { background: linear-gradient(to top, #1e3a8a 0%, #60a5fa 100%); }
        @keyframes ship-move-bob {
            0% { transform: translateX(-5px) translateY(0) rotate(-1deg); }
            50% { transform: translateX(5px) translateY(-8px) rotate(1deg); }
            100% { transform: translateX(-5px) translateY(0) rotate(-1deg); }
        }
        @keyframes smoke-rise {
            0% { opacity: 0.8; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(2); }
        }
        .scene-export-ship { left: 40%; top: 50%; font-size: 4rem; animation: ship-move-bob 3s infinite ease-in-out; z-index: 10; }
        .scene-export-smoke { left: 55%; top: 40%; font-size: 1rem; position: absolute; color: #374151; animation: smoke-rise 2s infinite; }
        .scene-export-wave { position: absolute; bottom: 0; width: 200%; font-size: 2rem; opacity: 0.6; animation: drive-action 10s infinite linear; color: rgba(255,255,255,0.3); }

        /* --- New Interaction Styles --- */
        .item-box { border: 2px solid #4b5563; transition: all 0.3s; }
        .item-box:hover { border-color: #d97706; background-color: #374151; }
        .item-box.selected { border-color: #10b981; background-color: rgba(16, 185, 129, 0.2); box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
        .item-box.wrong { border-color: #ef4444; background-color: rgba(239, 68, 68, 0.2); animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .logistics-btn { background-color: #374151; padding: 1rem; border-radius: 0.5rem; transition: all 0.2s; border: 1px solid #4b5563; }
        .logistics-btn:hover:not(:disabled) { background-color: #d97706; color: white; transform: scale(1.05); }
        .logistics-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Drag & Drop Styles */
        .draggable-card {
            background: #1f2937;
            border: 2px solid #4b5563;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: grab;
            width: 100px;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
        }
        .draggable-card:active {
            cursor: grabbing;
            transform: scale(1.05);
            border-color: #fbbf24;
        }
        .draggable-card.dragging {
            opacity: 0.5;
        }
        .drop-zone-active {
            background-color: rgba(245, 158, 11, 0.1);
            border-color: #fbbf24;
        }

        /* Leaderboard Styles */
        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 1rem; color: #e5e7eb; }
        .leaderboard-table th, .leaderboard-table td { padding: 0.75rem; border-bottom: 1px solid #374151; text-align: left; }
        .leaderboard-table th { color: #f59e0b; font-weight: bold; border-bottom: 2px solid #d97706; }
        .leaderboard-table tr:nth-child(1) td { color: #fbbf24; font-weight: bold; text-shadow: 0 0 5px rgba(251,191,36,0.3); } /* Gold */
        .leaderboard-table tr:nth-child(2) td { color: #e5e7eb; font-weight: bold; } /* Silver */
        .leaderboard-table tr:nth-child(3) td { color: #b45309; font-weight: bold; } /* Bronze */
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Sticky Progress Bar -->
    <div class="fixed top-0 left-0 w-full z-50 bg-gray-900 border-b border-gray-700 p-2 shadow-lg flex justify-between items-center px-4 md:px-8 h-16">
        <div class="flex items-center gap-2">
            <span class="text-2xl">â›ï¸</span>
            <span class="font-bold text-amber-500 hidden md:inline">åŸºéš†é»‘é‡‘æ¢éšªéšŠ</span>
        </div>
        <div class="flex-1 mx-4 max-w-md bg-gray-700 rounded-full h-4">
            <div id="progressBar" class="bg-amber-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="text-sm font-bold text-white text-right">
            <div>ç©åˆ†: <span id="scoreDisplay" class="text-amber-400 text-xl">0</span></div>
        </div>
    </div>

    <!-- Intro / Hero Section -->
    <section id="introSection" class="min-h-screen flex flex-col justify-center items-center text-center p-6 bg-[url('https://images.unsplash.com/photo-1518059639556-9d332d73318f?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center bg-no-repeat relative">
        <div class="absolute inset-0 bg-black bg-opacity-80"></div> <!-- Overlay -->
        <div class="relative z-10 max-w-3xl animate__animated animate__fadeInDown">
            <h1 class="text-5xl md:text-7xl font-black text-amber-500 mb-4 tracking-tight drop-shadow-lg">é»‘é‡‘æ­²æœˆ</h1>
            <h2 class="text-2xl md:text-3xl text-gray-300 font-light mb-8">åŸºéš†èˆ‡ç¤¦æ¥­çš„æ•¸æ“šè»Œè·¡äº’å‹•å±•</h2>
            <p class="text-lg text-gray-400 mb-8 leading-relaxed">
                å„ä½åŒå­¸ï¼Œæ­¡è¿ä¾†åˆ° 1960 å¹´ä»£çš„åŸºéš†ã€‚é‚£æ™‚é€™è£¡ä¸åªæ˜¯é›¨éƒ½ï¼Œæ›´æ˜¯å…¨å°ç£çš„èƒ½æºå¿ƒè‡Ÿã€‚<br>
                ä½ çš„ä»»å‹™æ˜¯é€šéå››å€‹å±¤ç´šçš„æ•¸æ“šè€ƒé©—ï¼Œäº†è§£é€™åº§åŸå¸‚çš„æ­·å²ï¼Œä¸¦æ”¶é›†è¶³å¤ çš„ã€Œç…¤ç‚­ç©åˆ†ã€ã€‚
            </p>
            <button onclick="startJourney()" class="btn-primary px-8 py-4 rounded-full text-xl font-bold shadow-lg animate__animated animate__pulse animate__infinite">
                æˆ´ä¸Šé ­ç‡ˆï¼Œé–‹å§‹æ¢éšª â–¼
            </button>
        </div>
    </section>

    <!-- Main Content Container -->
    <main id="mainContent" class="max-w-6xl mx-auto p-4 pt-20 hidden">

        <!-- LEVEL 1: The Golden Age -->
        <section id="level1" class="mb-24 opacity-0 transition-opacity duration-1000 scroll-mt-32">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-amber-600 text-white font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl">1</div>
                <h2 class="text-3xl font-bold text-white">ç¬¬ä¸€å±¤ï¼šç”¢é‡çš„å·”å³°</h2>
            </div>

            <!-- Equipment Check Game -->
            <div id="equipmentGamePanel" class="mb-8 p-6 bg-gray-800 rounded-xl border-l-8 border-amber-500 shadow-lg">
                <h3 class="text-xl font-bold text-white mb-2">ğŸ›‘ å…¥å‘å‰æ•´å‚™ (Warm-up)</h3>
                <p class="text-gray-300 mb-2">åœ¨æ·±å…¥äº†è§£æ­·å²æ•¸æ“šä¹‹å‰ï¼Œä½ å¿…é ˆç¢ºä¿è‡ªèº«å®‰å…¨ã€‚è«‹å¾ä¸‹æ–¹é¸å‡º **3 æ¨£** æ­£ç¢ºçš„å…¥å‘è£å‚™ã€‚</p>
                <div class="bg-gray-700/50 p-3 rounded-lg mb-4 border border-amber-500/30">
                    <span class="text-amber-400 font-bold">ğŸ’¡ è²¼å¿ƒå°æç¤ºï¼š</span>
                    <span class="text-gray-300 text-sm">ç¤¦å‘è£¡é¢ä¼¸æ‰‹ä¸è¦‹äº”æŒ‡ï¼Œæ‰€ä»¥ä½ éœ€è¦<strong>ç…§æ˜</strong>ï¼›å‘é“å¾ˆçŸ®å®¹æ˜“æ’åˆ°ï¼Œä¿è­·<strong>é ­éƒ¨</strong>å¾ˆé‡è¦ï¼›ç•¶ç„¶ï¼Œåˆ¥å¿˜äº†å¸¶ä¸Š<strong>åƒé£¯çš„å‚¢ä¼™</strong>ä¾†æŒ–ç…¤ï¼<br>
                    <span class="text-red-400">âš ï¸ æœ€é‡è¦çš„æ˜¯ï¼šå‘å…§æœ‰ç“¦æ–¯ï¼Œçµ•å°åš´ç¦ä»»ä½•ç«æºï¼</span></span>
                </div>
                <p id="equipFeedback" class="text-sm font-bold text-amber-400 min-h-[1.5rem] mb-4">è«‹é»æ“Šé¸æ“‡...</p>
                <div class="grid grid-cols-3 md:grid-cols-6 gap-4 text-center" id="equipGrid">
                    <!-- Correct Items -->
                    <!-- Custom Headlamp SVG -->
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'correct', 'é ­ç‡ˆï¼šä¸€å®šè¦å¸¶ï¼é˜²æ­¢ç“¦æ–¯çˆ†ç‚¸ï¼Œä¹Ÿèƒ½ç…§äº®é»‘æš—ã€‚')">
                        <div class="flex justify-center mb-1 h-9 items-center">
                            <svg class="w-10 h-10 text-yellow-400 drop-shadow-[0_0_8px_rgba(250,204,21,0.6)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="9" r="6" class="fill-gray-700 stroke-gray-400" />
                                <circle cx="12" cy="9" r="3" class="fill-yellow-300 stroke-yellow-500 animate-pulse" />
                                <rect x="10" y="1" width="4" height="2" class="fill-gray-500" />
                                <path d="M12 15v3c0 1.5 1 3 3 3h4" class="stroke-gray-500" />
                                <path d="M12 9l0 0" class="stroke-yellow-400 opacity-50"><animate attributeName="d" values="M12 9l0 0; M4 9l-2 0 M20 9l2 0 M12 17l0 2 M12 1l0 -2; M12 9l0 0" dur="2s" repeatCount="indefinite" /></path>
                            </svg>
                        </div>
                        <div class="text-xs">é ­ç‡ˆ</div>
                    </div>
                    
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'correct', 'è† ç›”ï¼šä¿è­·é ­éƒ¨ï¼Œå‘é“å¾ˆçŸ®ã€‚')"><div class="text-3xl mb-1">â›‘ï¸</div><div class="text-xs">è† ç›”</div></div>
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'correct', 'åå­—é¬ï¼šåƒé£¯çš„å‚¢ä¼™ã€‚')"><div class="text-3xl mb-1">â›ï¸</div><div class="text-xs">åå­—é¬</div></div>
                    <!-- Wrong Items -->
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'wrong', 'âŒ åš´ç¦ç…™ç«ï¼å‘å…§æœ‰ç“¦æ–¯ï¼Œæœƒçˆ†ç‚¸ï¼')"><div class="text-3xl mb-1">ğŸ”¥</div><div class="text-xs">ç«æŸ´</div></div>
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'wrong', 'âŒ åš´ç¦å¸è¸ï¼ä½ æœƒå®³æ­»å¤§å®¶ã€‚')"><div class="text-3xl mb-1">ğŸš¬</div><div class="text-xs">é¦™è¸</div></div>
                    <div class="item-box p-4 rounded cursor-pointer" onclick="selectItem(this, 'neutral', 'âŒ é›–ç„¶å¥½è½ï¼Œä½†å‘å…§è½ä¸åˆ°å»£æ’­ã€‚')"><div class="text-3xl mb-1">ğŸ“»</div><div class="text-xs">æ”¶éŸ³æ©Ÿ</div></div>
                </div>
            </div>

            <div id="level1-content" class="opacity-30 pointer-events-none transition-opacity duration-500 filter blur-sm">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 glass-panel p-6 rounded-xl">
                        <h3 class="text-xl font-bold text-amber-400 mb-4">ç…¤ç‚­ç”¢é‡æ™‚å…‰æ©Ÿ</h3>
                        <p class="text-gray-400 text-sm mb-4">è«‹ç§»å‹•ä¸‹æ–¹çš„æ»‘æ¡¿ï¼Œè§€å¯Ÿä¸åŒå¹´ä»£çš„ç”¢é‡è®ŠåŒ–èˆ‡æ­·å²äº‹ä»¶ã€‚</p>
                        <div class="chart-container bg-white rounded-lg p-2 mb-4"><canvas id="productionChart"></canvas></div>
                        <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                            <label for="yearSlider" class="block text-sm font-medium text-gray-300 mb-2">æ‹–å‹•å¹´ä»½ï¼š<span id="yearDisplay" class="text-amber-500 font-bold text-lg">1950</span></label>
                            <input type="range" min="0" max="9" value="0" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-amber-500" id="yearSlider">
                            <div id="yearInfo" class="mt-4 p-3 bg-gray-700 rounded text-gray-200 text-sm min-h-[80px]">1950å¹´ä»£ï¼šæˆ°å¾Œé‡å»ºæœŸï¼ŒåŸºéš†ç…¤ç¤¦é–‹å§‹å¾©ç”¦ã€‚</div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="flip-card" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><span class="text-4xl mb-2">ğŸ†</span><h4 class="font-bold text-white">æœ€é«˜ç”¢é‡ç´€éŒ„</h4><p class="text-xs text-gray-400 mt-2">é»æ“Šç¿»é–‹ç­”æ¡ˆ</p></div><div class="flip-card-back"><h4 class="font-bold text-2xl">500è¬+ å…¬å™¸</h4><p class="text-sm mt-2">ç™¼ç”Ÿåœ¨ 1968 å¹´ï¼Œç•¶æ™‚åŸºéš†æ¸¯é»‘ç…™ç€°æ¼«ï¼Œå…¨æ˜¯é‹ç…¤èˆ¹ã€‚</p></div></div></div>
                        <div class="flip-card" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><span class="text-4xl mb-2">ğŸ”š</span><h4 class="font-bold text-white">ç”¢æ¥­çµ‚çµ</h4><p class="text-xs text-gray-400 mt-2">é»æ“Šç¿»é–‹ç­”æ¡ˆ</p></div><div class="flip-card-back"><h4 class="font-bold text-2xl">2000 å¹´</h4><p class="text-sm mt-2">å°ç£æœ€å¾Œä¸€å£ç…¤ç¤¦é—œé–‰ï¼Œé»‘é‡‘æ™‚ä»£æ­£å¼è½å¹•ã€‚</p></div></div></div>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-gray-800 rounded-xl border-l-4 border-blue-500">
                    <h3 class="font-bold text-lg mb-4 text-blue-400">ğŸ“ éš¨å ‚æ¸¬é©— (è³ºå– 100 ç©åˆ†)</h3>
                    <p class="mb-4">æ ¹æ“šä¸Šåœ–ï¼Œå°ç£ç…¤ç¤¦ç”¢é‡é–‹å§‹å‘ˆç¾ã€Œæ–·å´–å¼ä¸‹è·Œã€æ˜¯åœ¨å“ªå€‹å¹´ä»£ä¹‹å¾Œï¼Ÿ</p>
                    <div class="flex gap-4 flex-wrap" id="quiz1-options">
                        <button onclick="checkAnswer(1, false, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">1950å¹´ä»£</button>
                        <button onclick="checkAnswer(1, true, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">1970å¹´ä»£ (çŸ³æ²¹å±æ©Ÿå¾Œ)</button>
                        <button onclick="checkAnswer(1, false, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">1990å¹´ä»£</button>
                    </div>
                    <div id="quiz1-feedback" class="mt-2 hidden font-bold"></div>
                </div>
                <div class="text-center mt-8">
                    <button id="btn-unlock-2" onclick="unlockLevel(2)" class="btn-primary px-6 py-3 rounded-full font-bold opacity-50 cursor-not-allowed" disabled>è§£é–ç¬¬äºŒå±¤ï¼šåœ°åœ–èˆ‡åˆ†ä½ˆ â–¼</button>
                </div>
            </div>
        </section>

        <!-- LEVEL 2: The Geography -->
        <section id="level2" class="mb-24 opacity-50 locked transition-all duration-1000 filter grayscale scroll-mt-32">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-amber-600 text-white font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl">2</div>
                <h2 class="text-3xl font-bold text-white">ç¬¬äºŒå±¤ï¼šé»‘é‡‘ç”Ÿæ´»åœˆ</h2>
            </div>
            
            <!-- Logistics Game: Timed Edition -->
            <div id="logisticsGamePanel" class="mb-8 p-6 bg-gray-900 rounded-xl border border-gray-700 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-2 opacity-10 text-9xl">ğŸš‚</div>
                <div class="relative z-10">
                    <h3 class="text-xl font-bold text-amber-400 mb-2">ğŸš‚ äº’å‹•éŠæˆ²ï¼šä¸ƒå µèª¿åº¦ç«™æŒ‘æˆ°è³½</h3>
                    <p class="text-gray-400 mb-4 text-sm">é™æ™‚ 30 ç§’ï¼ç›¡å¯èƒ½å°‡ç…¤ç‚­é€å¾€æ­£ç¢ºçš„åœ°æ–¹ï¼</p>
                    
                    <!-- Timer & Score Display -->
                    <div class="flex justify-between mb-4 bg-gray-800 p-3 rounded-lg border border-gray-600">
                        <div class="text-white font-mono text-xl">â³ å‰©é¤˜æ™‚é–“: <span id="gameTimer" class="text-red-400">30</span>s</div>
                        <div class="text-white font-mono text-xl">ğŸ“¦ èª¿åº¦æˆåŠŸ: <span id="sessionScore" class="text-green-400">0</span></div>
                    </div>

                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="bg-black border-4 border-gray-600 rounded-lg p-6 w-full md:w-1/2 text-center h-48 flex flex-col justify-center items-center shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]">
                            <div id="logistics-icon" class="text-5xl mb-2 animate-bounce">ğŸ“¦</div>
                            <div id="logistics-desc" class="text-xl font-bold text-green-400 font-mono">æº–å‚™å¥½äº†å—ï¼Ÿ<br>é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹</div>
                        </div>
                        <div class="w-full md:w-1/2 grid grid-cols-1 gap-3">
                            <button id="btn-export" onclick="checkLogistics('export')" class="logistics-btn" disabled><strong>ğŸš¢ é‹å¾€ç¢¼é ­ (å‡ºå£)</strong><br><span class="text-xs text-gray-400">é«˜å“è³ªå¡Šç…¤</span></button>
                            <button id="btn-power" onclick="checkLogistics('power')" class="logistics-btn" disabled><strong>âš¡ é‹å¾€ç™¼é›»å»  (èƒ½æº)</strong><br><span class="text-xs text-gray-400">å¤§é‡ç²‰ç…¤/æ™®é€šç…¤</span></button>
                            <button id="btn-domestic" onclick="checkLogistics('domestic')" class="logistics-btn" disabled><strong>ğŸ  é‹å¾€å¸‚å€ (æ°‘ç”Ÿ)</strong><br><span class="text-xs text-gray-400">ç…¤çƒ/å°‘é‡éœ€æ±‚</span></button>
                            <button id="btn-start-logistics" onclick="startLogisticsGame()" class="bg-amber-600 hover:bg-amber-500 text-white font-bold py-3 px-4 rounded mt-2">é–‹å§‹è¨ˆæ™‚æŒ‘æˆ°</button>
                        </div>
                    </div>
                    <p id="logistics-feedback" class="text-center mt-4 font-bold h-6 text-amber-500"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass-panel p-6 rounded-xl"><h3 class="text-lg font-bold text-amber-400 mb-2">ç”¢å€åˆ†ä½ˆ</h3><div class="chart-container bg-white rounded p-2"><canvas id="regionalChart"></canvas></div><p class="text-sm text-gray-400 mt-2">è§€å¯Ÿï¼šç‘èŠ³é›–ç„¶ç”¢é‡æœ€é«˜ï¼Œä½†åŸºéš†çš„ä¸ƒå µèˆ‡æš–æš–ä¹Ÿæ˜¯é‡è¦ç”¢åœ°ã€‚</p></div>
                <div class="glass-panel p-6 rounded-xl"><h3 class="text-lg font-bold text-amber-400 mb-2">ç…¤ç‚­å»å“ªäº†ï¼Ÿ</h3><div class="chart-container bg-white rounded p-2"><canvas id="usageChart"></canvas></div><p class="text-sm text-gray-400 mt-2">å¤§éƒ¨åˆ†çš„ç…¤ç‚­ä¸¦éå®¶ç”¨ï¼Œè€Œæ˜¯ç‚ºäº†æ¨å‹•å·¥æ¥­åŒ–ã€‚</p></div>
            </div>
            <div class="mt-8 p-6 bg-gray-800 rounded-xl border-l-4 border-blue-500">
                <h3 class="font-bold text-lg mb-4 text-blue-400">ğŸ“ éš¨å ‚æ¸¬é©— (è³ºå– 100 ç©åˆ†)</h3>
                <p class="mb-4">åŸºéš†é–‹æ¡å‡ºä¾†çš„ç…¤ç‚­ï¼Œæœ€å¤§å®—çš„ç”¨é€”æ˜¯ä»€éº¼ï¼Ÿ</p>
                <div class="flex gap-4 flex-wrap" id="quiz2-options">
                    <button onclick="checkAnswer(2, false, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">æ‹¿ä¾†çƒ¤è‚‰ (æ°‘ç”Ÿ)</button>
                    <button onclick="checkAnswer(2, true, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">ç«åŠ›ç™¼é›»</button>
                    <button onclick="checkAnswer(2, false, this)" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">ç…‰é‹¼</button>
                </div>
                <div id="quiz2-feedback" class="mt-2 hidden font-bold"></div>
            </div>
            <div class="text-center mt-8">
                <button id="btn-unlock-3" onclick="unlockLevel(3)" class="btn-primary px-6 py-3 rounded-full font-bold opacity-50 cursor-not-allowed" disabled>è§£é–ç¬¬ä¸‰å±¤ï¼šé‹ç…¤æµç¨‹ â–¼</button>
            </div>
        </section>

        <!-- LEVEL 3: The Process -->
        <section id="level3" class="mb-24 opacity-50 locked transition-all duration-1000 filter grayscale scroll-mt-32">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-amber-600 text-white font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl">3</div>
                <h2 class="text-3xl font-bold text-white">ç¬¬ä¸‰å±¤ï¼šå¾åœ°åº•åˆ°æ¸¯å£</h2>
            </div>

            <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 relative overflow-hidden">
                <p class="text-center mb-6 text-gray-400">é»æ“Šä¸‹æ–¹çš„åœ–ç¤ºï¼Œè§€å¯Ÿå‹•ç•«ä¸¦äº†è§£é‹ç…¤æ­¥é©Ÿï¼ˆéœ€æŸ¥çœ‹æ‰€æœ‰æ­¥é©Ÿæ‰èƒ½é–‹å•ŸæŒ‘æˆ°ï¼‰</p>
                <div class="flex flex-col md:flex-row items-center justify-between gap-4 z-10 relative">
                    <div id="step-mining" onclick="showDetail('mining')" class="cursor-pointer group flex flex-col items-center bg-gray-700 hover:bg-amber-900 p-6 rounded-lg w-full md:w-1/4 transition transform hover:scale-105 border border-transparent"><div class="text-4xl mb-3 icon-target">â›ï¸</div><h4 class="font-bold">1. é–‹æ¡</h4><div class="w-full h-1 bg-gray-600 mt-2 rounded overflow-hidden"><div class="h-full bg-amber-500 w-0 transition-all duration-300 status-bar"></div></div></div>
                    <span id="arrow-1" class="text-gray-500 text-2xl transition-all duration-500">â–¶</span>
                    <div id="step-transport" onclick="showDetail('transport')" class="cursor-pointer group flex flex-col items-center bg-gray-700 hover:bg-amber-900 p-6 rounded-lg w-full md:w-1/4 transition transform hover:scale-105 border border-transparent"><div class="text-4xl mb-3 icon-target">ğŸšƒ</div><h4 class="font-bold">2. é‹é€</h4><div class="w-full h-1 bg-gray-600 mt-2 rounded overflow-hidden"><div class="h-full bg-amber-500 w-0 transition-all duration-300 status-bar"></div></div></div>
                    <span id="arrow-2" class="text-gray-500 text-2xl transition-all duration-500">â–¶</span>
                    <div id="step-wash" onclick="showDetail('wash')" class="cursor-pointer group flex flex-col items-center bg-gray-700 hover:bg-amber-900 p-6 rounded-lg w-full md:w-1/4 transition transform hover:scale-105 border border-transparent"><div class="text-4xl mb-3 icon-target">ğŸ­</div><h4 class="font-bold">3. æ´—é¸</h4><div class="w-full h-1 bg-gray-600 mt-2 rounded overflow-hidden"><div class="h-full bg-amber-500 w-0 transition-all duration-300 status-bar"></div></div></div>
                    <span id="arrow-3" class="text-gray-500 text-2xl transition-all duration-500">â–¶</span>
                    <div id="step-export" onclick="showDetail('export')" class="cursor-pointer group flex flex-col items-center bg-gray-700 hover:bg-amber-900 p-6 rounded-lg w-full md:w-1/4 transition transform hover:scale-105 border border-transparent"><div class="text-4xl mb-3 icon-target">ğŸš¢</div><h4 class="font-bold">4. è¼¸å‡º</h4><div class="w-full h-1 bg-gray-600 mt-2 rounded overflow-hidden"><div class="h-full bg-amber-500 w-0 transition-all duration-300 status-bar"></div></div></div>
                </div>

                <div id="processDetailBox" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-gray-900 rounded border border-amber-500 min-h-[200px] hidden animate__animated animate__fadeIn">
                    <div><h4 id="detailTitle" class="text-xl font-bold text-amber-500 mb-2">æ­¥é©Ÿæ¨™é¡Œ</h4><p id="detailText" class="text-gray-300 leading-relaxed">æ­¥é©Ÿèªªæ˜æ–‡å­—...</p></div>
                    <div><h5 class="text-xs text-gray-500 uppercase tracking-widest mb-1">æƒ…å¢ƒæ¨¡æ“¬ (Simulation)</h5><div id="sceneContainer" class="scene-box"></div></div>
                </div>
                
                <div id="initialPrompt" class="mt-6 text-center text-gray-500 italic">(è«‹é»æ“Šä¸Šæ–¹æ­¥é©Ÿ 1 é–‹å§‹æ¨¡æ“¬)</div>

                <!-- DRAG AND DROP GAME -->
                <div id="orderingGameContainer" class="hidden mt-8 border-t border-gray-700 pt-8 animate__animated animate__fadeIn">
                    <div class="bg-gray-900 p-6 rounded-xl border border-amber-500 shadow-lg select-none">
                        <h3 class="text-xl font-bold text-amber-400 mb-2 text-center">ğŸ§  è¨˜æ†¶åŠ›å¤§è€ƒé©—ï¼šæ’åˆ—æ­£ç¢ºæ­¥é©Ÿ</h3>
                        <p class="text-center text-gray-400 mb-6">è«‹æ‹–æ‹‰ä¸‹æ–¹çš„å¡ç‰‡åˆ°è™›ç·šæ¡†ä¸­ï¼Œé‚„åŸæ­£ç¢ºçš„é‹ç…¤æµç¨‹ã€‚</p>

                        <!-- Drop Zone (Target) -->
                        <div id="dropZone" class="min-h-[120px] bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg p-4 flex flex-wrap gap-4 justify-center items-center mb-6 transition-colors">
                            <span class="text-gray-500 pointer-events-none" id="dropPlaceholder">è«‹å°‡æ­¥é©Ÿæ‹–æ‹‰è‡³æ­¤...</span>
                        </div>

                        <!-- Source Zone (Draggable items) -->
                        <div id="sourceZone" class="flex flex-wrap gap-4 justify-center min-h-[80px]">
                            <!-- Cards injected here -->
                        </div>

                        <div class="text-center mt-6">
                            <button onclick="checkDragOrder()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-6 rounded-full transition shadow-lg">é€å‡ºç­”æ¡ˆ</button>
                        </div>

                        <!-- Feedback -->
                        <p id="orderingFeedback" class="text-center mt-4 font-bold text-lg min-h-[1.5rem]"></p>
                    </div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button id="btn-unlock-4" onclick="unlockLevel(4)" class="btn-primary px-6 py-3 rounded-full font-bold opacity-50 cursor-not-allowed" disabled>è§£é–ç¬¬å››å±¤ï¼šæ·±å±¤é¢¨éšª â–¼</button>
            </div>
        </section>

        <!-- LEVEL 4: Risk Analysis -->
        <section id="level4" class="mb-24 opacity-50 locked transition-all duration-1000 filter grayscale scroll-mt-32">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-red-700 text-white font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl">4</div>
                <h2 class="text-3xl font-bold text-white">ç¬¬å››å±¤ï¼šç”Ÿæ­»äº¤é—œ</h2>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-panel p-6 rounded-xl"><h3 class="text-lg font-bold text-red-400 mb-2">è¶ŠæŒ–è¶Šæ·±ï¼Œè¶Šå±éšª</h3><p class="text-sm text-gray-400 mb-4">æ°£æ³¡å¤§å°ä»£è¡¨äº‹æ•…åš´é‡ç¨‹åº¦ã€‚éš¨è‘—ç¤¦å‘æ·±åº¦å¢åŠ ï¼ˆXè»¸ï¼‰ï¼Œé¢¨éšªæŒ‡æ•¸ï¼ˆYè»¸ï¼‰æ€¥åŠ‡ä¸Šå‡ã€‚</p><div id="riskPlot" class="w-full h-80 bg-white rounded-lg"></div></div>
                <div class="glass-panel p-6 rounded-xl border border-red-900 bg-gray-800"><h3 class="text-xl font-bold text-amber-500 mb-4">ğŸ® æ¨¡æ“¬æƒ…å¢ƒï¼šç¤¦å·¥çš„æŠ‰æ“‡</h3><div id="game-screen"><p class="text-gray-300 mb-6 text-lg leading-relaxed" id="game-text">ä½ æ˜¯ 1980 å¹´ä»£çš„ç¤¦å·¥ã€‚ä»Šå¤©å‰›ä¸‹åˆ°åœ°ä¸‹ 600 å…¬å°ºæ·±è™•ã€‚çªç„¶ï¼Œä½ ç™¼ç¾æ›åœ¨å‘å£ä¸Šçš„é‡‘çµ²é›€åœæ­¢äº†å«è²ï¼Œè€Œä¸”ç©ºæ°£ä¸­ç€°æ¼«è‘—ä¸€è‚¡æ·¡æ·¡çš„çˆ›è˜‹æœå‘³...</p><div class="grid grid-cols-1 gap-4" id="game-buttons"><button onclick="playGame(1)" class="p-4 bg-gray-700 hover:bg-red-600 rounded text-left transition border border-gray-600"><strong>A. ç¹¼çºŒæŒ–ç…¤</strong> - ä»Šå¤©ç”¢é‡é‚„æ²’é”æ¨™ï¼Œæœƒè¢«æ‰£éŒ¢ã€‚</button><button onclick="playGame(2)" class="p-4 bg-gray-700 hover:bg-green-600 rounded text-left transition border border-gray-600"><strong>B. ç«‹åˆ»æ’¤é›¢</strong> - ä¸Ÿä¸‹å·¥å…·ï¼Œé€šçŸ¥éšŠå‹å¾€é€šé¢¨å£è·‘ã€‚</button></div><div id="game-result" class="hidden mt-4 p-4 rounded font-bold text-center"></div></div></div>
            </div>
        </section>

        <!-- Final Score & Leaderboard Section -->
        <section id="finalSection" class="hidden mb-24 animate__animated animate__fadeIn">
            <div class="max-w-2xl mx-auto bg-gray-800 p-8 rounded-xl border-2 border-amber-500 shadow-2xl text-center">
                <h2 class="text-3xl font-black text-amber-500 mb-4">ğŸ† æ¢éšªä»»å‹™å®Œæˆï¼</h2>
                <p class="text-gray-400 mb-6">æ­å–œä½ å®Œæˆäº†æ‰€æœ‰é—œå¡ã€‚çœ‹çœ‹ä½ çš„æœ€çµ‚æˆç¸¾ï¼</p>
                
                <div class="text-6xl font-black text-white mb-8 text-shadow-glow">
                    <span id="endGameScore">0</span> <span class="text-2xl text-gray-500">åˆ†</span>
                </div>

                <!-- Name Input -->
                <div id="saveScoreForm" class="mb-8 flex justify-center">
                    <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥åå­—/ä»£è™Ÿ" class="bg-gray-700 text-white border border-gray-600 rounded-l-lg px-4 py-3 w-48 md:w-64 focus:outline-none focus:border-amber-500" maxlength="8">
                    <button onclick="saveHighscore()" class="bg-amber-600 hover:bg-amber-500 text-white font-bold py-3 px-6 rounded-r-lg transition">
                        è¨˜éŒ„æˆç¸¾
                    </button>
                </div>

                <!-- Leaderboard Table -->
                <div id="leaderboardDisplay" class="hidden text-left">
                    <h3 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-600 pb-2">ğŸ“œ æœ¬æ©Ÿè‹±é›„æ¦œ (Top 5)</h3>
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>æ’å</th>
                                <th>æ¢éšªå®¶</th>
                                <th>åˆ†æ•¸</th>
                                <th>æ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                    <button onclick="location.reload()" class="mt-6 w-full py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition">å†æ¬¡æŒ‘æˆ°</button>
                </div>
            </div>
        </section>

        <footer class="text-center py-12 border-t border-gray-800">
            <h3 class="text-2xl font-bold text-gray-500 mb-4">æ­å–œå®Œæˆé»‘é‡‘æ¢éšªï¼</h3>
            <button onclick="resetProgress()" class="mt-2 px-4 py-2 bg-gray-700 hover:bg-red-600 text-white rounded text-xs transition">æ¸…é™¤æ‰€æœ‰ç´€éŒ„ (æ•™å¸«ç”¨)</button>
        </footer>
    </main>

    <!-- Scripts -->
    <script>
        let score = 0;
        let currentLevel = 1;
        
        // --- Audio Context & Sound Helper ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playCorrectSound() { playTone(600, 'sine', 0.1); setTimeout(() => playTone(800, 'sine', 0.2), 100); }
        function playWrongSound() { playTone(150, 'sawtooth', 0.3); }
        function playGameEndSound() { playTone(400, 'sine', 0.1); setTimeout(() => playTone(500, 'sine', 0.1), 150); setTimeout(() => playTone(600, 'sine', 0.4), 300); }

        function updateScore(points) {
            score += points;
            document.getElementById('scoreDisplay').innerText = score;
            const display = document.getElementById('scoreDisplay');
            display.classList.add('animate__animated', 'animate__heartBeat');
            setTimeout(() => display.classList.remove('animate__heartBeat'), 1000);
        }
        
        // --- Leaderboard System ---
        function getLeaderboard() {
            return JSON.parse(localStorage.getItem('keelung_coal_leaderboard') || '[]');
        }

        function saveHighscore() {
            const nameInput = document.getElementById('playerName');
            let name = nameInput.value.trim();
            if (!name) name = "ç„¡åç¤¦å·¥";
            
            const today = new Date().toLocaleDateString();
            const newRecord = { name: name, score: score, date: today };
            
            // Get existing, add new, sort, slice top 5
            let leaderboard = getLeaderboard();
            leaderboard.push(newRecord);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 5);
            
            localStorage.setItem('keelung_coal_leaderboard', JSON.stringify(leaderboard));
            
            // Render and show
            renderLeaderboard();
            document.getElementById('saveScoreForm').classList.add('hidden');
            document.getElementById('leaderboardDisplay').classList.remove('hidden');
            playGameEndSound();
        }

        function renderLeaderboard() {
            const leaderboard = getLeaderboard();
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            if (leaderboard.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500">å°šç„¡ç´€éŒ„</td></tr>';
                return;
            }

            leaderboard.forEach((record, index) => {
                const tr = document.createElement('tr');
                let rankIcon = index + 1;
                if(index === 0) rankIcon = 'ğŸ¥‡';
                if(index === 1) rankIcon = 'ğŸ¥ˆ';
                if(index === 2) rankIcon = 'ğŸ¥‰';
                
                tr.innerHTML = `
                    <td>${rankIcon}</td>
                    <td>${record.name}</td>
                    <td>${record.score}</td>
                    <td class="text-gray-500 text-sm">${record.date}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function resetProgress() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ’è¡Œæ¦œç´€éŒ„ä¸¦é‡æ–°é–‹å§‹å—ï¼Ÿ')) {
                localStorage.removeItem('keelung_coal_leaderboard');
                location.reload();
            }
        }

        function startJourney() {
            document.getElementById('introSection').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('animate__animated', 'animate__fadeIn');
            setTimeout(() => { initCharts(); }, 100);
            document.getElementById('progressBar').style.width = '25%';
            const l1 = document.getElementById('level1');
            l1.classList.remove('opacity-0');
            l1.classList.add('animate__animated', 'animate__fadeInUp');
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function unlockLevel(level) {
            const section = document.getElementById(`level${level}`);
            const btn = document.getElementById(`btn-unlock-${level}`);
            if (btn) {
                btn.innerHTML = "å·²è§£é– âœ“";
                btn.classList.remove('btn-primary');
                btn.classList.add('bg-green-600', 'text-white');
            }
            section.classList.remove('opacity-50', 'locked', 'filter', 'grayscale');
            section.classList.add('animate__animated', 'animate__fadeIn');
            const percent = level * 25;
            document.getElementById('progressBar').style.width = `${percent}%`;
            const elementRect = section.getBoundingClientRect();
            const absoluteElementTop = elementRect.top + window.pageYOffset;
            const headerOffset = 88;
            window.scrollTo({ top: absoluteElementTop - headerOffset, behavior: 'smooth' });
        }

        function checkAnswer(quizId, isCorrect, btnElement) {
            const feedbackEl = document.getElementById(`quiz${quizId}-feedback`);
            const optionsDiv = document.getElementById(`quiz${quizId}-options`);
            if (isCorrect) {
                const buttons = optionsDiv.querySelectorAll('button');
                buttons.forEach(b => b.disabled = true);
                btnElement.classList.remove('bg-gray-700');
                btnElement.classList.add('bg-green-600', 'text-white');
                feedbackEl.innerText = "ç­”å°äº†ï¼ç²å¾— 100 ç©åˆ†ï¼";
                feedbackEl.classList.remove('text-red-400');
                feedbackEl.classList.add('text-green-400');
                updateScore(100);
                playCorrectSound();
                const nextLevelBtn = document.getElementById(`btn-unlock-${quizId + 1}`);
                if (nextLevelBtn) {
                    nextLevelBtn.disabled = false;
                    nextLevelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    nextLevelBtn.classList.add('animate__animated', 'animate__pulse', 'animate__infinite');
                }
            } else {
                btnElement.disabled = true;
                btnElement.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                btnElement.classList.add('bg-red-600', 'text-white', 'opacity-50', 'cursor-not-allowed');
                feedbackEl.innerText = "ç­”éŒ¯å›‰ï¼è«‹å†è©¦ä¸€æ¬¡çœ‹çœ‹ï¼";
                feedbackEl.classList.remove('text-green-400');
                feedbackEl.classList.add('text-red-400');
                playWrongSound();
            }
            feedbackEl.classList.remove('hidden');
        }

        // Equipment Game
        let selectedEquipCount = 0;
        let equipmentSolved = false;
        function selectItem(el, type, msg) {
            const feedback = document.getElementById('equipFeedback');
            if (equipmentSolved || el.classList.contains('selected') || el.classList.contains('wrong')) return;
            if (type === 'wrong') {
                el.classList.add('wrong');
                feedback.innerText = msg;
                feedback.className = "text-sm font-bold text-red-500 animate__animated animate__flash";
                updateScore(-10);
                playWrongSound();
                setTimeout(() => { el.classList.remove('wrong'); feedback.className = "text-sm font-bold text-amber-400"; feedback.innerText = "è«‹é‡æ–°é¸æ“‡..."; }, 2000);
            } else if (type === 'neutral') {
                el.classList.add('wrong');
                feedback.innerText = msg;
                playWrongSound();
                setTimeout(() => el.classList.remove('wrong'), 1000);
            } else {
                el.classList.add('selected');
                selectedEquipCount++;
                feedback.innerText = msg + ` (${selectedEquipCount}/3)`;
                feedback.className = "text-sm font-bold text-green-400";
                playCorrectSound();
                if (selectedEquipCount === 3) {
                    equipmentSolved = true;
                    feedback.innerText = "âœ… è£å‚™é½Šå…¨ï¼å‡†è¨±ä¸‹å‘ï¼è³‡æ–™åº«å·²è§£é–ã€‚";
                    updateScore(50);
                    playGameEndSound();
                    const content = document.getElementById('level1-content');
                    content.classList.remove('opacity-30', 'pointer-events-none', 'filter', 'blur-sm');
                    content.classList.add('animate__animated', 'animate__fadeIn');
                }
            }
        }

        // Logistics Game: Timed & Scored
        const logisticsData = [{ id: 'high', icon: 'ğŸ’', desc: 'é«˜å“è³ªå¡Šç…¤ (ç‡ƒç‡’ç†±å€¼é«˜)', target: 'export' }, { id: 'power', icon: 'âš¡', desc: 'æ™®é€šç²‰ç…¤ (ç™¼é›»ç”¨)', target: 'power' }, { id: 'coke', icon: 'ğŸ§±', desc: 'ç…¤çƒ/ç„¦ç‚­ (å®¶åº­èˆ‡å·¥æ¥­)', target: 'domestic' }];
        let currentLogisticsTask = null;
        let logisticsSessionScore = 0;
        let logisticsTimer = 30;
        let logisticsInterval = null;

        function startLogisticsGame() {
            logisticsSessionScore = 0;
            logisticsTimer = 30;
            document.getElementById('sessionScore').innerText = logisticsSessionScore;
            document.getElementById('gameTimer').innerText = logisticsTimer;
            document.getElementById('btn-start-logistics').classList.add('hidden');
            document.querySelectorAll('.logistics-btn').forEach(b => b.disabled = false);
            if (audioCtx.state === 'suspended') audioCtx.resume();
            logisticsInterval = setInterval(() => {
                logisticsTimer--;
                document.getElementById('gameTimer').innerText = logisticsTimer;
                if (logisticsTimer <= 0) { endLogisticsGame(); }
            }, 1000);
            nextLogisticsRound();
        }

        function endLogisticsGame() {
            clearInterval(logisticsInterval);
            document.getElementById('logistics-icon').innerText = 'ğŸ‰';
            document.getElementById('logistics-desc').innerHTML = `æ™‚é–“åˆ°ï¼<br>ä½ æˆåŠŸèª¿åº¦äº† ${logisticsSessionScore} æ‰¹ç…¤ç‚­ï¼`;
            document.getElementById('logistics-feedback').innerText = '';
            document.querySelectorAll('.logistics-btn').forEach(b => b.disabled = true);
            playGameEndSound();
        }

        function nextLogisticsRound() {
            currentLogisticsTask = logisticsData[Math.floor(Math.random() * logisticsData.length)];
            document.getElementById('logistics-icon').innerText = currentLogisticsTask.icon;
            document.getElementById('logistics-desc').innerText = currentLogisticsTask.desc;
            document.getElementById('logistics-feedback').innerText = 'è«‹é¸æ“‡å»è™•...';
        }

        function checkLogistics(choice) {
            const feedback = document.getElementById('logistics-feedback');
            if (choice === currentLogisticsTask.target) {
                feedback.innerText = "âœ… èª¿åº¦æ­£ç¢ºï¼+10 åˆ†";
                feedback.className = "text-center mt-4 font-bold h-6 text-green-400";
                logisticsSessionScore++;
                document.getElementById('sessionScore').innerText = logisticsSessionScore;
                updateScore(10);
                playCorrectSound();
                nextLogisticsRound();
            } else {
                feedback.innerText = "âŒ é€éŒ¯åœ°æ–¹äº†ï¼æ‰£ 5 åˆ†";
                feedback.className = "text-center mt-4 font-bold h-6 text-red-400";
                updateScore(-5);
                playWrongSound();
            }
        }

        // Slider
        const sliderData = [{ year: '1950', text: "1950å¹´ä»£ï¼šæˆ°å¾Œé‡å»ºæœŸï¼ŒåŸºéš†ç…¤ç¤¦é–‹å§‹å¾©ç”¦ï¼Œä¸»è¦ä¾›æ‡‰å°éµè’¸æ±½ç«è»Šã€‚" }, { year: '1955', text: "1955å¹´ï¼šç”¢é‡ç©©å®šæˆé•·ï¼Œå°å‹ç¤¦å‘éåœ°é–‹èŠ±ã€‚" }, { year: '1960', text: "1960å¹´ä»£ï¼šå°ç£ç¶“æ¿Ÿèµ·é£›ï¼Œå·¥æ¥­ç”¨é›»éœ€æ±‚å¤§å¢ï¼Œé»‘é‡‘èº«åƒ¹æ°´æ¼²èˆ¹é«˜ã€‚" }, { year: '1965', text: "1965å¹´ï¼šé–‹æ¡æŠ€è¡“æå‡ï¼Œä½†ä¹Ÿé–‹å§‹å¾€æ›´æ·±å±¤æŒ–æ˜ã€‚" }, { year: '1968', text: "â˜… 1968å¹´ (å·”å³°)ï¼šå…¨å°ç”¢é‡çªç ´500è¬å™¸ï¼ŒåŸºéš†æ¸¯è¼¸å‡ºé‡é”æ­·å²æœ€é«˜é»ï¼" }, { year: '1975', text: "1970å¹´ä»£ï¼šé­é‡å…©æ¬¡çŸ³æ²¹å±æ©Ÿï¼Œç…¤ç¤¦é›–é‡è¦ï¼Œä½†é–‹æ¡æˆæœ¬å·²å¤§å¹…ä¸Šå‡ã€‚" }, { year: '1980', text: "1980å¹´ä»£ï¼šç¤¦å‘ç½è®Šé »å‚³ï¼ŒåŠ ä¸Šé€²å£ç…¤ç‚­æ›´ä¾¿å®œï¼Œç”¢æ¥­é–‹å§‹èµ°ä¸‹å¡ã€‚" }, { year: '1985', text: "1984å¹´ï¼šç™¼ç”Ÿæµ·å±±ã€ç…¤å±±ã€æµ·å±±ä¸€å‘ä¸‰å¤§ç½è®Šï¼Œæ”¿åºœè½‰å‘ã€Œæ”¶å‘ã€æ”¿ç­–ã€‚" }, { year: '1990', text: "1990å¹´ä»£ï¼šçµ•å¤§å¤šæ•¸ç¤¦å ´é—œé–‰ï¼ŒåŸºéš†å±±åŸå›æ­¸å¯§éœã€‚" }, { year: '2000', text: "2000å¹´ï¼šå°ç£æœ€å¾Œä¸€å£ç…¤ç¤¦å ´é—œé–‰ï¼Œé»‘é‡‘æ­²æœˆæ­£å¼æˆç‚ºæ­·å²ã€‚" }];
        document.getElementById('yearSlider').addEventListener('input', function(e) {
            const idx = e.target.value;
            const data = sliderData[idx];
            document.getElementById('yearDisplay').innerText = data.year;
            document.getElementById('yearInfo').innerText = data.text;
        });

        // Level 3 Details
        const processDetails = {
            'mining': { title: '1. é–‹æ¡ (Mining)', text: 'ç¤¦å·¥éœ€æ·±å…¥åœ°åº•æ•¸ç™¾å…¬å°ºï¼Œå¿å—æ”æ°40åº¦é«˜æº«ã€‚ä½¿ç”¨é‡å‹å·¥å…·æŒ–æ˜ï¼Œå¡µåœŸé£›æšï¼Œç’°å¢ƒè‰±å›°ã€‚', iconAnim: 'animate-dig', bgClass: 'bg-cave', sceneHtml: `<div class="scene-element scene-mining-tool">â›ï¸</div><div class="scene-element scene-mining-coal">âš«</div><div class="scene-element scene-mining-dust">â˜ï¸</div>` },
            'transport': { title: '2. é‹é€ (Transport)', text: 'å¾å‘å£å‡ºä¾†å¾Œï¼Œä½¿ç”¨ã€Œä¸‰åˆ†è»Šã€æˆ–è¼•ä¾¿è»Œé“ï¼ˆå°è»Šï¼‰ï¼Œæ²¿è‘—å´å¶‡çš„å±±è·¯æ»‘è¡Œè‡³é›†æ•£ç«™ã€‚', iconAnim: 'animate-drive', bgClass: 'bg-rails', sceneHtml: `<div class="scene-element scene-transport-cart">ğŸšƒ</div><div class="scene-track-decor"></div>` },
            'wash': { title: '3. æ´—é¸ (Processing)', text: 'åœ¨æ´—ç…¤å ´åˆ©ç”¨æ°´æŸ±æ²–æ´—èˆ‡éœ‡å‹•ç¯©é¸ï¼Œå°‡é›œè³ªåˆ†é›¢ã€‚ç¾å ´æ°´èŠ±å››æ¿ºï¼Œæ©Ÿå™¨éœ‡è€³æ¬²è¾ã€‚', iconAnim: 'animate-wash', bgClass: 'bg-wash', sceneHtml: `<div class="scene-wash-water-bg"></div><div class="scene-element scene-wash-coal-pile"><span style="font-size:2rem">âš«</span><span style="font-size:2rem">âš«</span></div><div class="scene-wash-spray">ğŸ’¦</div>` },
            'export': { title: '4. è¼¸å‡º (Export)', text: 'é»‘é‡‘é‹æŠµåŸºéš†æ¸¯ã€‚å·¨å¤§çš„é‹ç…¤èˆ¹åœæ³Šåœ¨ç¢¼é ­ï¼Œå†’è‘—é»‘ç…™ï¼Œæº–å‚™å°‡èƒ½æºé€å¾€å„åœ°ã€‚', iconAnim: 'animate-float', bgClass: 'bg-sea', sceneHtml: `<div class="scene-element scene-export-ship">ğŸš¢</div><div class="scene-export-smoke">â˜ï¸</div><div class="scene-export-wave">ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸</div>` }
        };
        const visitedSteps = new Set();
        function showDetail(key) {
            const detailBox = document.getElementById('processDetailBox');
            const prompt = document.getElementById('initialPrompt');
            const titleEl = document.getElementById('detailTitle');
            const textEl = document.getElementById('detailText');
            const sceneContainer = document.getElementById('sceneContainer');
            const data = processDetails[key];
            prompt.classList.add('hidden');
            detailBox.classList.remove('hidden');
            titleEl.innerText = data.title;
            textEl.innerText = data.text;
            sceneContainer.innerHTML = data.sceneHtml;
            sceneContainer.className = 'scene-box';
            sceneContainer.classList.add(data.bgClass);
            document.querySelectorAll('.icon-target').forEach(el => { el.classList.remove('animate-dig', 'animate-drive', 'animate-wash', 'animate-float'); });
            const stepBtn = document.getElementById(`step-${key}`);
            const icon = stepBtn.querySelector('.icon-target');
            icon.classList.add(data.iconAnim);
            stepBtn.classList.add('border-green-500');
            stepBtn.querySelector('h4').classList.add('text-green-400');
            stepBtn.querySelector('.status-bar').style.width = '100%';
            if (key === 'mining') document.getElementById('arrow-1').classList.add('flow-active');
            if (key === 'transport') document.getElementById('arrow-2').classList.add('flow-active');
            if (key === 'wash') document.getElementById('arrow-3').classList.add('flow-active');
            visitedSteps.add(key);
            if(visitedSteps.size === 4) {
                const gameContainer = document.getElementById('orderingGameContainer');
                if(gameContainer.classList.contains('hidden')) {
                    gameContainer.classList.remove('hidden');
                    startOrderingGame();
                    setTimeout(() => { gameContainer.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 500);
                }
            }
        }

        // Drag and Drop Logic
        const correctOrder = ['mining', 'transport', 'wash', 'export'];
        const stepLabels = { 'mining': { icon: 'â›ï¸', label: 'é–‹æ¡' }, 'transport': { icon: 'ğŸšƒ', label: 'é‹é€' }, 'wash': { icon: 'ğŸ­', label: 'æ´—é¸' }, 'export': { icon: 'ğŸš¢', label: 'è¼¸å‡º' } };
        let draggedItem = null;

        function startOrderingGame() {
            const sourceZone = document.getElementById('sourceZone');
            sourceZone.innerHTML = '';
            const dropZone = document.getElementById('dropZone');
            dropZone.innerHTML = '<span class="text-gray-500 pointer-events-none" id="dropPlaceholder">è«‹å°‡æ­¥é©Ÿæ‹–æ‹‰è‡³æ­¤...</span>';
            const shuffled = [...correctOrder].sort(() => Math.random() - 0.5);
            shuffled.forEach(step => {
                const div = document.createElement('div');
                div.className = 'draggable-card';
                div.draggable = true;
                div.id = step;
                div.innerHTML = `<div class="text-3xl mb-1">${stepLabels[step].icon}</div><div class="text-xs font-bold text-white">${stepLabels[step].label}</div>`;
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                sourceZone.appendChild(div);
            });
            [sourceZone, dropZone].forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) { draggedItem = this; setTimeout(() => this.classList.add('dragging'), 0); }
        function handleDragEnd(e) { this.classList.remove('dragging'); draggedItem = null; document.querySelectorAll('.drop-zone-active').forEach(el => el.classList.remove('drop-zone-active')); }
        function handleDragOver(e) { e.preventDefault(); }
        function handleDragEnter(e) { e.preventDefault(); this.classList.add('drop-zone-active'); }
        function handleDragLeave(e) { this.classList.remove('drop-zone-active'); }
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drop-zone-active');
            if (this.id === 'dropZone' || this.id === 'sourceZone') {
                this.appendChild(draggedItem);
                checkPlaceholder();
            }
        }
        function checkPlaceholder() {
            const dropZone = document.getElementById('dropZone');
            const placeholder = document.getElementById('dropPlaceholder');
            if (dropZone.querySelectorAll('.draggable-card').length > 0) placeholder.classList.add('hidden');
            else placeholder.classList.remove('hidden');
        }

        function checkDragOrder() {
            const dropZone = document.getElementById('dropZone');
            const cards = Array.from(dropZone.querySelectorAll('.draggable-card'));
            const feedback = document.getElementById('orderingFeedback');
            if (cards.length !== 4) { feedback.innerText = "âŒ è«‹å°‡æ‰€æœ‰ 4 å¼µå¡ç‰‡éƒ½æ‹–é€²æ¡†æ¡†ä¸­ï¼"; feedback.className = "text-center mt-4 font-bold text-lg text-amber-400"; return; }
            const currentOrder = cards.map(c => c.id);
            const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(correctOrder);
            if (isCorrect) {
                feedback.innerText = "ğŸ‰ å…¨å°ï¼æµç¨‹é‚è¼¯æ¸…æ™°ï¼Œç¬¬å››å±¤å·²è§£é–ï¼";
                feedback.className = "text-center mt-4 font-bold text-lg text-green-400";
                updateScore(50);
                playCorrectSound();
                cards.forEach(c => { c.draggable = false; c.style.borderColor = '#10b981'; c.style.cursor = 'default'; });
                document.querySelector('button[onclick="checkDragOrder()"]').disabled = true;
                document.querySelector('button[onclick="checkDragOrder()"]').classList.add('opacity-50', 'cursor-not-allowed');
                const btn = document.getElementById('btn-unlock-4');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.classList.add('animate__animated', 'animate__pulse', 'animate__infinite');
            } else {
                feedback.innerText = "âŒ é †åºä¸å°å–”ï¼è«‹é‡æ–°èª¿æ•´å†è©¦è©¦ã€‚";
                feedback.className = "text-center mt-4 font-bold text-lg text-red-400 animate__animated animate__shakeX";
                setTimeout(() => feedback.classList.remove('animate__shakeX'), 1000);
                dropZone.classList.add('animate__animated', 'animate__shakeX');
                setTimeout(() => dropZone.classList.remove('animate__animated', 'animate__shakeX'), 500);
                playWrongSound();
            }
        }

        // Mini Game (Level 4)
        function playGame(choice) {
            const resultBox = document.getElementById('game-result');
            const buttonsDiv = document.getElementById('game-buttons');
            resultBox.classList.remove('hidden', 'bg-green-600', 'bg-red-600');
            if (choice === 1) {
                resultBox.classList.add('bg-red-600', 'text-white');
                resultBox.innerHTML = "ğŸ’€ <strong>æ‚²åŠ‡ç™¼ç”Ÿï¼š</strong><br>é‚£æ˜¯ç“¦æ–¯å¤–æ´©çš„å‰å…†ï¼å¹¾åˆ†é˜å¾Œç™¼ç”Ÿäº†å¡µçˆ†ã€‚å¿½è¦–è­¦è¨Šæ˜¯ç¤¦å ´å¤§å¿Œã€‚<br>(æ‰£é™¤ 50 ç©åˆ†)";
                updateScore(-50);
                playWrongSound();
            } else {
                resultBox.classList.add('bg-green-600', 'text-white');
                resultBox.innerHTML = "âœ… <strong>æˆåŠŸå­˜æ´»ï¼š</strong><br>ä½ çš„è­¦è¦ºæ•‘äº†å…¨éšŠï¼é‚£æ˜¯å±éšªçš„ç“¦æ–¯å‘³ã€‚é›–ç„¶ä»Šå¤©æ²’è³ºåˆ°å·¥è³‡ï¼Œä½†æ´»è‘—æœ€é‡è¦ã€‚<br>(ç²å¾— 100 ç©åˆ†)";
                updateScore(100);
                playCorrectSound();
            }
            buttonsDiv.classList.add('opacity-50', 'pointer-events-none');
            
            // --- NEW: Trigger Final Section ---
            setTimeout(() => {
                document.getElementById('endGameScore').innerText = score;
                const finalSection = document.getElementById('finalSection');
                finalSection.classList.remove('hidden');
                finalSection.scrollIntoView({ behavior: 'smooth' });
                // If score qualifies as high score logic is inside saveHighscore now
            }, 1500);
        }

        function initCharts() {
            Chart.defaults.color = '#9ca3af';
            Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
            new Chart(document.getElementById('productionChart'), { type: 'line', data: { labels: ['1950', '1955', '1960', '1965', '1968', '1975', '1980', '1985', '1990', '2000'], datasets: [{ label: 'å¹´ç”¢ç…¤é‡ (è¬å…¬å™¸)', data: [180, 240, 380, 480, 510, 450, 320, 210, 80, 0], borderColor: '#d97706', backgroundColor: 'rgba(217, 119, 6, 0.2)', borderWidth: 3, pointBackgroundColor: '#fff', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#374151' } }, x: { grid: { display: false } } } } });
            new Chart(document.getElementById('regionalChart'), { type: 'bar', data: { labels: ['ç‘èŠ³', 'æš–æš–(åŸºéš†)', 'ä¸ƒå µ(åŸºéš†)', 'å¹³æºª', 'é›™æºª'], datasets: [{ label: 'ç”¢å‡ºä½”æ¯” %', data: [45, 20, 15, 12, 8], backgroundColor: ['#4b5563', '#d97706', '#d97706', '#9ca3af', '#9ca3af'], borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } } });
            new Chart(document.getElementById('usageChart'), { type: 'doughnut', data: { labels: ['ç«åŠ›ç™¼é›»', 'å·¥æ¥­ç‡ƒæ–™', 'æ°‘ç”Ÿä½¿ç”¨', 'å…¶ä»–'], datasets: [{ data: [55, 25, 15, 5], backgroundColor: ['#d97706', '#1f2937', '#3b82f6', '#9ca3af'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } } });
            const trace1 = { x: [200, 350, 450, 600, 750, 900], y: [5, 12, 25, 40, 65, 90], mode: 'markers+text', type: 'scatter', marker: { size: [15, 20, 25, 30, 40, 50], color: '#ef4444', opacity: 0.8, line: { color: '#fff', width: 1 } }, text: ['1950s', '1960s', '1970s', '1980åˆæœŸ', '1984ç½è®Š', 'æ¥µé™æ·±å±¤'], textposition: 'top center', textfont: { family: 'Noto Sans TC', color: 'white' }, hoverinfo: 'x+y+text', hovertemplate: 'æ·±åº¦: %{x}m<br>é¢¨éšª: %{y}<br>å¹´ä»£: %{text}<extra></extra>' };
            const layout = { title: { text: 'é–‹æ¡æ·±åº¦ vs äº‹æ•…é¢¨éšª', font: { color: '#fff' } }, xaxis: { title: 'æ·±åº¦ (å…¬å°º)', gridcolor: '#374151', color: '#9ca3af' }, yaxis: { title: 'é¢¨éšªæŒ‡æ•¸', gridcolor: '#374151', color: '#9ca3af' }, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', margin: { t: 40, r: 20, b: 40, l: 40 }, showlegend: false };
            Plotly.newPlot('riskPlot', [trace1], layout, { displayModeBar: false, responsive: true });
        }
    </script>
</body>
</html>
